[4mnxt_unit_..._add_field[24m(3)  Library Functions Manual  [4mnxt_unit_..._add_field[24m(3)

[1mName[0m
       nxt_unit_response_add_field - add field to HTTP response in Unit app

[1mLibrary[0m
       NGINX Unit library ([4mlibunit[24m, [4m‚Äêlunit[24m)

[1mSynopsis[0m
       [1m#include <nxt_unit.h>[0m

       [1mint nxt_unit_response_add_field(nxt_unit_request_info_t *[4m[22mreq[24m[1m,[0m
                                       [1mconst char [4m[22mname[24m[1m[.[4m[22mnlen[24m[1m], uint8_t [4m[22mnlen[24m[1m,[0m
                                       [1mconst char [4m[22mvalue[24m[1m[.[4m[22mvlen[24m[1m], uint32_t [4m[22mvlen[24m[1m);[0m

[1mArguments[0m
       [4mreq[24m    Request object.

       [4mname[24m   Name of the field.  It is a character sequence of length [4mnlen[24m.

       [4mvalue[24m  Value of the field.  It is a character sequence of length [4mvlen[24m.

[1mDescription[0m
       [4mnxt_unit_response_add_field[24m(3)  adds  a  field to the header of an HTTP
       response.

       The   response   should   have   been   initialized   previously   with
       [4mnxt_unit_response_init[24m(3).

       If  the  [1mContent-Length  [22mheader  field  is  not  sent, Unit will send a
       [1mTransfer‚ÄêEncoding: chunked [22mresponse, and will  produce  the  header  if
       necessary.

[1mReturn value[0m
       0 on success, or a non‚Äêzero error code on error.

[1mErrors[0m
       Errors will be reported in the Unit debug log.

       [1mNXT_UNIT_ERROR[0m
              ‚Ä¢  Response not initialized.
              ‚Ä¢  Too many response fields.
              ‚Ä¢  Field is longer than the response buffer.

[1mExamples[0m
       Below  is  a  request and response pair, and the source code to produce
       it.

       See [4mnxt_unit_init[24m(3) for an example where the  [4mrequest_handler[24m()  func‚Äê
       tion defined below is used.

   [1mRequest[0m
       $ [1mecho -e 'GET / HTTP/1.1\r\nHost: _\n' | ncat localhost 80;[0m
       HTTP/1.1 200 OK
       Content-Type: text/plain
       Content-Length: 42
       Server: Unit/1.30.0
       Date: Sat, 22 May 2023 20:45:50 GMT

       Hello world!

   [1mC code[0m
       #include <string.h>

       #include <nxt_unit.h>

       void
       request_handler(nxt_unit_request_info_t *req)
       {
           int  rc;

           rc = nxt_unit_response_init(req, 200, 2, strlen("Content-Type")
                                                    + strlen("text/plain")
                                                    + strlen("Content-Length")
                                                    + strlen("42")
                                                    + strlen("Hello world!\n"));
           if (rc != 0) {
               goto fail;
           }

           rc = nxt_unit_response_add_field(req, "Content-Type",
                                                 strlen("Content-Type"),
                                                 "text/plain",
                                                 strlen("text/plain"));
           if (rc != 0) {
               goto fail;
           }

           rc = nxt_unit_response_add_field(req, "Content-Length",
                                                 strlen("Content-Length"),
                                                 "42",
                                                 strlen("42"));
           if (rc != 0) {
               goto fail;
           }

           rc = nxt_unit_response_add_content(req, "Hello", strlen("Hello"));
           if (rc != 0) {
               goto fail;
           }
           rc = nxt_unit_response_add_content(req, " world!\n",
                                                   strlen(" world!\n"));
           if (rc != 0) {
               goto fail;
           }

           rc = nxt_unit_response_send(req);

           nxt_unit_req_debug(req, "Response sent.");

       fail:
           nxt_unit_request_done(req, rc);
       }

[1mCopyright[0m
       (C) 2017‚Äê2023, NGINX, Inc.

       SPDX‚ÄêLicense‚ÄêIdentifier: Apache‚Äê2.0

[1mSee also[0m
       [4mnxt_unit_init[24m(3),                            [4mnxt_unit_response_init[24m(3),
       [4mnxt_unit_response_add_content[24m(3),            [4mnxt_unit_response_send[24m(3),
       [4mnxt_unit_request_done[24m(3), [4munitd[24m(8)

       RFC  9112,  section  5:  Field  Syntax ‚ü®https://www.rfc‚Äêeditor.org/rfc/
       rfc9112#section‚Äê5‚ü©

       Website ‚ü®https://unit.nginx.org‚ü©

       Mailing list ‚ü®https://mailman.nginx.org/mailman/listinfo/unit‚ü©

       GitHub ‚ü®https://github.com/nginx/unit‚ü©

NGINX Unit (unreleased)             (date)           [4mnxt_unit_..._add_field[24m(3)
